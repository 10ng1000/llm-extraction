(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3b812de3","chunk-5240f868"],{"1c7f":function(e,t,n){},4375:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-dialog",{attrs:{id:"tag-editor",title:"文件标签编辑",visible:e.tagEditorShow},on:{"update:visible":function(t){e.tagEditorShow=t}}},[n("div",{staticStyle:{"padding-bottom":"10px"}},[n("el-select",{attrs:{placeholder:"请选择",size:"small"},model:{value:e.currentTagPrefix,callback:function(t){e.currentTagPrefix=t},expression:"currentTagPrefix"}},e._l(e.tagPrefix,(function(t){return n("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.options,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)})),1)],1),n("div",{staticStyle:{"padding-bottom":"10px"}},[n("el-select",{attrs:{"allow-create":"",size:"small",filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入关键词","remote-method":e.getRelatedTags,loading:e.searchLoading},model:{value:e.currentTagSuffix,callback:function(t){e.currentTagSuffix=t},expression:"currentTagSuffix"}},e._l(e.related_tags,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),n("el-button",{staticClass:"button-new-tag",attrs:{type:"primary",size:"small"},on:{click:e.handleInputConfirm}},[e._v("添加标签")])],1),e._l(e.tags,(function(t){return n("el-tag",{key:t,attrs:{closable:"","disable-transitions":!1,size:"medium"},on:{close:function(n){return e.handleDelete(t)}}},[e._v(" "+e._s(t)+" ")])}))],2)],1)},i=[],r=(n("a4d3"),n("e01a"),n("d28b"),n("c975"),n("fb6a"),n("a434"),n("b0c0"),n("d3b7"),n("ac1f"),n("3ca3"),n("1276"),n("ddb0"),{name:"TagEditor.vue",data:function(){return{currentTagSuffix:"",currentTagPrefix:"",tagPrefix:[{label:"常用",options:[{value:"模版",label:"模板"},{value:"历史文件",label:"历史文件"}]},{label:"默认",options:[{value:"默认",label:"默认"}]}],tagEditorShow:this.tagEditorShow,fileID:this.fileID,tags:[],related_tags:[],inputVisible:!1,inputValue:"",searchLoading:!1}},props:{tagEditorShow:{type:Boolean,required:!0},fileID:{type:String,required:!0}},created:function(){this.getAllTags()},mounted:function(){this.getFileTags()},methods:{getRelatedTags:function(e){this.searchLoading=!0;var t=this,n={input:e,num:20};t.$api.tagEditor.getRelatedLabels(n).then((function(e){if(200===e.code){var n=[],a=!0,i=!1,r=void 0;try{for(var o,s=e.data[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value,c=void 0;c=-1!=l.name.indexOf(":")?l.name.split(":").slice(1):l.name;var d={value:c,label:l.name};n.push(d)}}catch(u){i=!0,r=u}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}t.related_tags=n,t.searchLoading=!1}})).catch((function(e){t.searchLoading=!1,t.$message.error("getRelatedTags: "+e)}))},getAllTags:function(){var e=this;e.$api.tagEditor.getLabels().then((function(t){if(200===t.code){var n=[],a=!0,i=!1,r=void 0;try{for(var o,s=t.data[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value,c={value:l.name,label:l.name};n.push(c)}}catch(d){i=!0,r=d}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}e.all_tags=n}})).catch((function(t){e.$message.error("getAllTags: "+t)}))},getFileTags:function(){var e=this,t={fileID:e.fileID};e.$api.tagEditor.getLabels(t).then((function(t){if(200===t.code){var n=[],a=!0,i=!1,r=void 0;try{for(var o,s=t.data[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;n.push(l.name)}}catch(c){i=!0,r=c}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}e.tags=n}})).catch((function(t){e.$message.error("getFileTags: "+t)}))},handleDelete:function(e){var t=this,n=this,a={fileID:n.fileID,name:e};n.$api.tagEditor.deleteFileLabel(a).then((function(n){200===n.code&&t.tags.splice(t.tags.indexOf(e),1)})).catch((function(e){n.$message.error("getFileTags: "+e)}))},handleInputConfirm:function(){var e;if(e="默认"===this.currentTagPrefix?this.currentTagSuffix:this.currentTagPrefix+":"+this.currentTagSuffix,e){var t=this,n={fileID:t.fileID,name:e};t.$api.tagEditor.createLabel(n).then((function(n){200===n.code&&t.tags.push(e)})).catch((function(e){t.$message.error("handleInputConfirm: "+e)}))}this.inputVisible=!1,this.inputValue=""}},watch:{tagEditorShow:function(e){this.$emit("tagEditorShow",e)},fileID:function(){this.getFileTags()}}}),o=r,s=(n("a0fc5"),n("2877")),l=Object(s["a"])(o,a,i,!1,null,"43e0d6c4",null);t["default"]=l.exports},"6b43":function(e,t,n){"use strict";var a=n("1c7f"),i=n.n(a);i.a},7610:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[n("div",{staticClass:"main",attrs:{id:"graphcontainerdiv"}},[n("div",{staticClass:"graphcontainer",attrs:{id:"graphcontainer"},on:{click:e.graphContainerClick}})]),n("div",{attrs:{id:"illustration"}},e._l(e.illustrations,(function(t,a){return n("div",{key:a},[n("span",{staticStyle:{cursor:"pointer"},style:{backgroundColor:e.nodeColorMap.get(t)},attrs:{"data-index":a}}),e._v(" "+e._s(t)+" ")])})),0)])},i=[],r=(n("99af"),n("4de4"),n("7db0"),n("4160"),n("c975"),n("fb6a"),n("a434"),n("b0c0"),n("4ec9"),n("b680"),n("b64b"),n("d3b7"),n("acd8"),n("e25e"),n("3ca3"),n("c7cd"),n("159b"),n("ddb0"),n("96cf"),n("2ef0")),o=n.n(r),s=n("5698"),l=n("858e"),c=n("4375"),d=n("eed2"),u={name:"KnowledgeGraphList",computed:{fid:function(){var e="1";return e}},watch:{fid:{immediate:!0,handler:function(e){var t=this;this.currentFile.id=e,this.$nextTick((function(){t.doKG()}))}}},components:{TagEditor:c["default"],pdf:l["a"]},data:function(){return{visible:!1,tabIdx:"first",tagEditorShow:!1,svg:null,simulation:null,linkGroup:null,linktextGroup:null,nodeGroup:null,nodetextGroup:null,nodesymbolGroup:null,nodebuttonGroup:null,nodebuttonAction:"",tooltip:null,txx:{},tyy:{},nodedetail:null,nodedetailCN:new Object({"头节点":"","名称":"","尾节点":"","节点类型":"","页数":""}),nodeinfo:new Map,nodedetailCnList:new Map([["sourcename","头节点"],["name","名称"],["targetname","尾节点"],["fileID",""],["uuid",""],["type","节点类型"],["page_num","页数"]]),pagesizelist:[{size:100,isactive:!0},{size:500,isactive:!1},{size:1e3,isactive:!1},{size:2e3,isactive:!1}],hopssizelist:[{size:1,isactive:!0},{size:2,isactive:!1},{size:3,isactive:!1},{size:4,isactive:!1},{size:5,isactive:!1}],predefineColors:["#ff4500","#ff8c00","#90ee90","#00ced1","#1e90ff","#c71585"],nodeColorMap:new Map([["书籍名","#19CAAD"],["危险","#8CC7B5"],["原理","#A0EEE1"],["参数","#BEEDC7"],["定义","#BEE7E9"],["定义内容","#D6D5B7"],["属性","#D1BA74"],["操作","#E6CEAC"],["标准/规范","#ECAD9E"],["步骤","#F4606C"],["注意","#F6FF75"],["特性","#E1A1FF"],["章节名","#FFECA1"],["要求","#FC6A6A"],["警告","#8D7DC9"],["设备","#3F69A3"],["零部件","#C6F716"],["故障","#F28500"]]),dataconfigactive:"",isedit:!1,isaddnode:!1,isaddlink:!1,isdeletelink:!1,isbatchcreate:!1,iscreategraph:!1,selectnodeid:0,selectnodename:"",selectsourcenodeid:0,selecttargetnodeid:0,domain:"",domainid:0,domainnodename:"",nodename:"",pagesize:100,cyphertext:"",cyphertextshow:!1,jsonshow:!1,propactiveName:"propedit",properties:{},propertyCreate:!1,selectnode:{name:"",count:0},pageModel:{pageIndex:1,pageSize:10,totalCount:0,totalPage:0,nodeList:[]},graph:{nodes:[],links:[]},graphEntity:{fileID:"",uuid:0,name:"",color:"ff4500",r:40,x:"",y:""},createGraphEntity:{graphname:"",domaintype:"",nodename:"",fileID:""},currentDomain:"无",currentFile:{file:!0,id:"",leaf:!0,name:"",pdf:""},pageNum:1,pageTotalNum:1,scale:100,idx:-1,pdfUrl:"",pdfUrls:new Map([["1","制冷与低温技术原理.pdf"],["2","降膜机组使用说明书v5.0.pdf"],["3","降膜机组调试要点说明书v5.0.pdf"],["4","离心式／螺杆式制冷机组及应用.pdf"],["5","制冷与空调装置.pdf"]]),Recommend:[],hops:1,activeNames:["名称","节点类型","组成","包含","原理为","原因","特性为","定义为","步骤为","处理方式","符合","参数为","同义词","故障"],illustrations:[],failure_type:"",tempalte_id:""}},filters:{labelformat:function(e){var t=e.substring(1,e.length-1);return t}},mounted:function(){},created:function(){this.failurePredictService=new d["a"]},methods:{init:function(e,t){var n=this;n.failure_type=e,n.tempalte_id=t,n.visible=!0,n.$api.kgManager.getFailurePredictDomainGraph({failure_type:n.failure_type,tempalte_id:n.tempalte_id}).then((function(e){if(console.log(e),200===e.code){var t=e.data;null!=t&&(n.graph.nodes=t.node,n.graph.links=t.relationship,n.initgraph(),n.updategraph())}})).catch((function(e){n.$message.error("没有相关知识，请参考相关推荐")}))},tagEditorShowChange:function(e){this.tagEditorShow=e},testFileID:function(){this.doKG()},nodedetailCnProcess:function(e){var t=this,n=new Object;return Object.keys(e).forEach((function(a){""!=t.nodedetailCnList.get(a)&&void 0!==t.nodedetailCnList.get(a)&&(n[t.nodedetailCnList.get(a)]=e[a])})),n},doKG:function(){this.graph={nodes:[],links:[]},this.updategraph()},blankMenubarLeave:function(){document.getElementById("blank_menubar").style.display="none"},blankMenubarClick:function(){document.getElementById("blank_menubar").style.display="none"},graphContainerRightClick:function(e){this.svg.selectAll(".buttongroup").classed("circle_opreate",!0);var t=e.clientX,n=e.clientY;document.getElementById("blank_menubar").style.position="absolute",document.getElementById("blank_menubar").style.left=t+"px",document.getElementById("blank_menubar").style.top=n+"px",document.getElementById("blank_menubar").style.display="block",e.preventDefault()},graphContainerClick:function(e){"circle"!==e.target.tagName&&"link"!==e.target.tagName&&s["j"]("#nodedetail").style("display","none");var t=document.getElementById("graphcontainer").style.cursor;"crosshair"===t&&(s["j"](".graphcontainer").style("cursor",""),this.txx=e.offsetX,this.tyy=e.offsetY,this.createSingleNode()),"link_menubar"!==e.target.id&&"link_menubar"!==e.target.parentElement.id&&"link_menubar"!==e.target.parentElement.parentElement.id&&(document.getElementById("link_menubar").style.display="none"),e.preventDefault()},linkMenubarLeave:function(){s["j"]("#link_menubar").style("display","none")},globalMousedown:function(e){"link_menubar"!==e.target.id&&"link_menubar"!==e.target.parentElement.id&&"link_menubar"!==e.target.parentElement.parentElement.id&&(document.getElementById("link_menubar").style.display="none")},createdomain:function(e){var t=this,n={fileID:t.createGraphEntity.fileID,domain:t.createGraphEntity.graphname,domainname:t.createGraphEntity.domaintype,nodename:t.createGraphEntity.nodename};t.$api.kgManager.createDomain(n).then((function(n){200===n.code?(t.getlabels(),t.domain=e,t.getdomaingraph()):t.$message({showClose:!0,message:n.msg,type:"warning"})})).catch((function(e){t.$message.error("createdomain: "+e)}))},getlabels:function(){var e=this,t={};e.$api.kgManager.getGraph(t).then((function(t){200===t.code&&(e.pageModel=t.data,e.pageModel.totalPage=parseInt((t.data.totalCount-1)/t.data.pageSize)+1)})).catch((function(t){e.$message.error("getlabels: "+t)}))},getdomaingraph:function(){var e;return regeneratorRuntime.async((function(t){while(1)switch(t.prev=t.next){case 0:return e=this,e.loading=!0,{fileID:e.currentFile.id,domain:e.domain,nodename:e.domainnodename,pageSize:e.pagesize,hops:e.hops,Matchtype:1},t.next=5,regeneratorRuntime.awrap(e.$api.kgManager.getFailurePredictDomainGraph({failure_type:e.failure_type,tempalte_id:e.tempalte_id}).then((function(t){if(console.log(t),200===t.code){var n=t.data;null!=n&&(e.graph.nodes=n.node,e.graph.links=n.relationship,e.updategraph())}})).catch((function(t){e.$message.error("没有相关知识，请参考相关推荐")})));case 5:case"end":return t.stop()}}),null,this)},getsearchdomaingraph:function(){var e,t;return regeneratorRuntime.async((function(n){while(1)switch(n.prev=n.next){case 0:if(this.nodeinfo=null,""==this.nodename){n.next=12;break}return e=this.domainnodename,this.domainnodename=this.nodename,t=this.domain,this.domain="ALL",n.next=8,regeneratorRuntime.awrap(this.getdomaingraph());case 8:this.domain=t,this.domainnodename=e,n.next=14;break;case 12:return n.next=14,regeneratorRuntime.awrap(this.getdomaingraph());case 14:case"end":return n.stop()}}),null,this)},matchdomaingraph:function(e,t){this.domain=e.domainname,this.domainid=e.id,this.domainnodename=e.nodename,this.currentDomain=e.name,this.currentFile.id=e.file_id,this.getdomaingraph()},matchgraph:function(e,t){this.domain="",this.domainid="",this.currentDomain=e,this.getdomaingraph()},clickRecommend:function(e,t){this.nodename=e,this.getsearchdomaingraph()},deletedomain:function(e){var t=this;t.$confirm("此操作将删除该标签及其下节点和关系(不可恢复), 是否继续?","三思而后行",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(n){var a={fileID:t.currentFile.id,domain:e};t.$api.kgManager.deleteDomain(a).then((function(e){200===e.code?(t.getlabels(),t.domain=""):t.$message({showClose:!0,message:e.msg,type:"warning"})})).catch((function(e){t.$message.error("deletedomain: "+e)}))})).catch((function(){this.$message({type:"info",message:"已取消删除"})}))},getmoredomain:function(){var e=this;e.pageModel.pageIndex=e.pageModel.pageIndex+1;var t={pageIndex:e.pageModel.pageIndex};e.$api.kgManager.getGraph(t).then((function(t){200===t.code&&e.pageModel.nodeList.push.apply(e.pageModel.nodeList,t.data.nodeList)})).catch((function(t){e.$message.error("getmoredomain: "+t)}))},setmatchsize:function(e,t){for(var n=0;n<this.pagesizelist.length;n++)this.pagesizelist[n].isactive=!1,this.pagesizelist[n].size===e.size&&(this.pagesizelist[n].isactive=!0);this.pagesize=e.size,this.getsearchdomaingraph()},sethopssize:function(e,t){for(var n=0;n<this.hopssizelist.length;n++)this.hopssizelist[n].isactive=!1,this.hopssizelist[n].size===e.size&&(this.hopssizelist[n].isactive=!0);this.hops=e.size,this.getsearchdomaingraph()},showCypher:function(){this.cyphertextshow=!this.cyphertextshow},cypherjson:function(){0!==this.graph.nodes.length||0!==this.graph.links.length?this.jsonshow=!this.jsonshow:this.$message.error("请先选择领域或者执行cypher")},cypherrun:function(){var e=this;if(""!==e.cyphertext){var t={fileID:e.currentFile.id,cypher:e.cyphertext};e.$api.kgManager.getCypherResult(t).then((function(t){200===t.code?(e.graph.nodes=t.data.node,e.graph.links=t.data.relationship,e.updategraph()):e.$message.error(t.msg)})).catch((function(t){e.$message.error("cypherrun: "+t)}))}else e.$message.error("请输入cypher语句")},prophandleClick:function(e,t){"properties"===e.name&&this.getProperties(this.graphEntity.type,this.graphEntity.uuid)},initgraph:function(){var e=s["j"](".graphcontainer");console.log(e);var t=400,n=300;this.svg=e.append("svg"),console.log(this.svg),this.svg.attr("width",t),this.svg.attr("height",n),this.simulation=s["h"]().force("link",s["f"]().distance((function(e){return Math.floor(200*Math.random())+100})).id((function(e){return e.uuid}))).force("charge",s["g"]().strength(-400).distanceMax(400)).force("collide",s["e"](30).strength(.9).iterations(1)).force("center",s["d"](t/2,(n-200)/2)).alpha(1).alphaTarget(0).alphaDecay(.01),this.linktextGroup=this.svg.append("g").attr("class","linetext"),this.linkGroup=this.svg.append("g").attr("class","line"),this.nodeGroup=this.svg.append("g").attr("class","node"),this.nodetextGroup=this.svg.append("g").attr("class","nodetext"),this.nodesymbolGroup=this.svg.append("g").attr("class","nodesymbol"),this.nodebuttonGroup=this.svg.append("g").attr("class","nodebutton"),this.addmaker(),this.tooltip=this.svg.append("div").style("opacity",0),this.svg.on("click",(function(){s["k"](".buttongroup").classed("circle_opreate",!0)}),"false")},updategraph:function(){var e=this,t=e.graph.links,n=e.graph.nodes,a=[],i=(s["j"](".graphcontainer"),e.domainnodename,0);if(n.forEach((function(t){var n=e.similar(t.name,e.domainnodename,2);n>i&&(i=n,t.name)})),e.illustrations=[],n.forEach((function(t){t.fx=null,t.fy=null,"undefined"!=typeof t.fx&&""!==t.fx&&null!=t.fx||(t.fx=null),"undefined"!=typeof t.fy&&""!==t.fy&&null!=t.fy||(t.fy=null),"string"==typeof t.fx&&(t.fx=parseFloat(t.fx)),"string"==typeof t.fy&&(t.fy=parseFloat(t.fy)),-1==e.illustrations.indexOf(t.type)&&e.illustrations.push(t.type)})),t.forEach((function(e){var t=n.filter((function(t){return t.uuid===e.sourceid}))[0];if("undefined"!=typeof t){var i=n.filter((function(t){return t.uuid===e.targetid}))[0];"undefined"!=typeof i&&a.push({source:t.uuid,target:i.uuid,lk:e})}})),e.addnodebutton(),a.length>0){o.a.each(a,(function(e){var t=o.a.filter(a,{source:e.source,target:e.target}),n=o.a.filter(a,{source:e.target,target:e.source}),i=t.concat(n);o.a.each(i,(function(e,t){e.sameIndex=t+1,e.sameTotal=i.length,e.sameTotalHalf=e.sameTotal/2,e.sameUneven=e.sameTotal%2!==0,e.sameMiddleLink=!0===e.sameUneven&&Math.ceil(e.sameTotalHalf)===e.sameIndex,e.sameLowerHalf=e.sameIndex<=e.sameTotalHalf,e.sameArcDirection=1,e.sameIndexCorrected=e.sameLowerHalf?e.sameIndex:e.sameIndex-Math.ceil(e.sameTotalHalf)}))}));var r=o.a.chain(a).sortBy((function(e){return e.sameTotal})).last().value().sameTotal;o.a.each(a,(function(e){e.maxSameHalf=Math.round(r/2)}))}var l=e.linkGroup.selectAll(".line >path").data(a,(function(e){return e.uuid}));l.exit().remove();var c=e.drawlink(l);l=c.merge(l),e.linktextGroup.selectAll("text").data(a,(function(e){return e.uuid})).exit().remove();var d=e.linktextGroup.selectAll("text >textPath").data(a,(function(e){return e.uuid}));d.exit().remove();var u=e.drawlinktext(d);d=u.merge(d).text((function(e){return e.lk.name})),s["k"](".nodebutton >g").remove();var f=e.nodebuttonGroup.selectAll(".nodebutton").data(n,(function(e){return e}));f.exit().remove();var p=e.drawnodebutton(f);f=p.merge(f);var h=e.nodeGroup.selectAll("circle").data(n,(function(e){return e.uuid}));h.exit().remove();var g=e.drawnode(h);h=g.merge(h).text((function(e){return e.name}));var m=e.nodetextGroup.selectAll("text").data(n,(function(e){return e.uuid}));m.exit().remove();var v=e.drawnodetext(m);m=v.merge(m).text((function(e){if("undefined"==typeof e.name)return"";if(e.name.length>8){var t=e.name.slice(0,7)+"...";return t}return e.name})),m.append("title").text((function(e){return e.name}));var y=e.nodesymbolGroup.selectAll("path").data(n,(function(e){return e.uuid}));y.exit().remove();var k=e.drawnodesymbol(y);function x(e){var t=e.target.x-e.source.x,n=e.target.y-e.source.y,a=Math.sqrt(t*t+n*n),i=e.sameUneven?0:.5,r=2,o=1/r*(a*e.maxSameHalf/(e.sameIndexCorrected-i));e.sameMiddleLink&&(o=0);var s="M"+e.source.x+","+e.source.y+"A"+o+","+o+" 0 0,"+e.sameArcDirection+" "+e.target.x+","+e.target.y;return s}function b(){l.attr("d",x),h.attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y})),f.attr("cx",(function(e){return e.x})).attr("cy",(function(e){return e.y})),f.attr("transform",(function(e){return"translate("+e.x+","+e.y+") scale(1)"})),m.attr("x",(function(e){return e.x})).attr("y",(function(e){return e.y})),y.attr("transform",(function(e){return"translate("+(e.x+8)+","+(e.y-30)+") scale(0.015,0.015)"}))}y=k.merge(y),y.attr("fill","#e15500"),y.attr("display",(function(e){return"undefined"!=typeof e.hasfile&&e.hasfile>0?"block":"none"})),e.simulation.nodes(n).on("tick",b),e.simulation.force("link").links(a),e.simulation.alpha(1).alphaTarget(0).alphaDecay(.01).restart();var w=s["l"]().on("zoom",(function(){s["k"](".node").attr("transform",s["n"](e.svg.node())),s["k"](".nodetext").attr("transform",s["n"](e.svg.node())),s["k"](".line").attr("transform",s["n"](e.svg.node())),s["k"](".linetext").attr("transform",s["n"](e.svg.node())),s["k"](".nodesymbol").attr("transform",s["n"](e.svg.node())),s["k"](".nodebutton").attr("transform",s["n"](e.svg.node()))}));e.svg.call(w),e.svg.call(w.transform,s["m"]),e.svg.call(s["l"]().on("zoom",(function(){s["j"]("#link_menubar").style("display","none"),s["j"]("#nodedetail").style("display","none"),s["k"](".node").attr("transform",s["c"].transform),s["k"](".nodetext").attr("transform",s["c"].transform),s["k"](".line").attr("transform",s["c"].transform),s["k"](".linetext").attr("transform",s["c"].transform),s["k"](".nodesymbol").attr("transform",s["c"].transform),s["k"](".nodebutton").attr("transform",s["c"].transform)}))),e.svg.on("dblclick.zoom",null),e.svg.selectAll(".buttongroup").on("click",(function(t,n){if(e.nodebuttonAction){switch(e.nodebuttonAction){case"EDIT":e.isedit=!0,e.propactiveName="propedit",e.txx=t.x,e.tyy=t.y;break;case"MORE":e.getmorenode(t);break;case"LINK":e.isaddlink=!0,e.selectsourcenodeid=t.uuid;break;case"DELETE":e.selectnodeid=t.uuid;var a=".out_buttongroup_"+n;e.deletenode(a);break}}})),e.svg.selectAll(".action_0").on("click",(function(t){e.nodebuttonAction="EDIT"})),e.svg.selectAll(".action_1").on("click",(function(t){e.nodebuttonAction="MORE"})),e.svg.selectAll(".action_2").on("click",(function(t){e.nodebuttonAction="LINK"})),e.svg.selectAll(".action_3").on("click",(function(t){e.nodebuttonAction="DELETE"}))},requestFullScreen:function(){var e=document.getElementById("graphcontainerdiv"),t=window.screen.width,n=window.screen.height;this.svg.attr("width",t),this.svg.attr("height",n),e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()},saveproperties:function(){var e=this,t={fileID:e.currentFile.id,label:e.domain,id:e.graphEntity.uuid,properties:JSON.stringify(e.properties)};e.$api.kgManager.saveProperties(t).then((function(t){200===t.code?e.$message({message:"操作成功",type:"success"}):e.$message({message:t.msg,type:"error"})})).catch((function(t){e.$message.error("saveproperties: "+t)}))},createnode:function(){var e=this,t={domain:e.domain,fileID:e.currentFile.id,name:e.graphEntity.name};e.$api.kgManager.createNode(t).then((function(t){if(200===t.code){if(0!==e.graphEntity.uuid)for(var n=0;n<e.graph.nodes.length;n++)e.graph.nodes[n].uuid===e.graphEntity.uuid&&e.graph.nodes.splice(n,1);var a=t.data;a.x=e.txx,a.y=e.tyy,a.fx=e.txx,a.fy=e.tyy,e.graph.nodes.push(a),e.resetentity(),e.updategraph(),e.isedit=!1,e.resetsubmit()}})).catch((function(t){e.$message.error("createnode: "+t)}))},resetentity:function(){this.graphEntity={fileID:this.currentFile.id,uuid:0,color:"ff4500",name:"",r:40,x:"",y:""}},resetsubmit:function(){this.isaddnode=!1,this.isedit=!1,this.resetentity(),this.fieldDataList=[],this.dataconfigactive="",this.isbatchcreate=!1,this.selectnodeid=0},newProperty:function(){({})!==this.properties&&(this.properties[document.getElementById("newPropertyInput").value]="",this.propertyCreate=!1)},addnodebutton:function(e){s["k"]("svg >defs").remove();var t=this.graph.nodes,n=[1,1,1,1],a=s["i"](),i=a(n),r=this.svg.append("defs");t.forEach((function(e){var t=r.append("g").attr("id","out_circle"+e.uuid),n=t.selectAll(".buttongroup").data(i).enter().append("g").attr("class",(function(e,t){return"action_"+t})),a=30;"undefined"==typeof e.r&&(e.r=a);var o=s["a"]().innerRadius(e.r).outerRadius(e.r+30);n.append("path").attr("d",(function(e){return o(e)})).attr("fill","#D2D5DA").style("opacity",.6).attr("stroke","#f0f0f4").attr("stroke-width",2),n.append("text").attr("transform",(function(e,t){return"translate("+o.centroid(e)+")"})).attr("text-anchor","middle").text((function(e,t){var n=new Array;return n[0]="编辑",n[1]="展开",n[2]="连线",n[3]="删除",n[t]})).attr("font-size",10)}))},btnaddsingle:function(){s["j"](".graphcontainer").style("cursor","crosshair")},getProperties:function(e,t){var n=this,a={fileID:n.currentFile.id,label:e,id:t};n.$api.kgManager.getProperties(a).then((function(e){200===e.code&&(n.properties=e.data)})).catch((function(e){n.$message.error("getProperties: "+e)}))},getcurrentnodeinfo:function(e){var t=this,n={fileID:t.currentFile.id,domain:t.domain,nodeid:e.uuid};t.$api.kgManager.getRelationNodeCount(n).then((function(n){200===n.code&&(t.selectnode.name=e.name,t.selectnode.count=n.data)})).catch((function(e){t.$message.error("getcurrentnodeinfo: "+e)}))},getmorenode:function(e){var t=this,n={nodeid:t.selectnodeid};t.$api.kgManager.getMoreRelationNode(n).then((function(e){if(200===e.code){var n=e.data.node,a=e.data.relationship,i=t.graph.nodes.length,r=t.graph.links.length;n.forEach((function(e){var n=t.graph.nodes.find((function(t){return t.uuid===e.uuid}));"undefined"==typeof n&&t.graph.nodes.push(e)})),a.forEach((function(e){var n=t.graph.links.find((function(t){return t.uuid===e.uuid}));"undefined"==typeof n&&t.graph.links.push(e)}));var o=t.graph.links.length,s=t.graph.nodes.length;if(s<=i&&o<=r)return void t.$message({message:"没有更多信息",type:"success"});t.updategraph()}})).catch((function(e){t.$message.error("getmorenode: "+e)}))},createSingleNode:function(){var e=this,t={fileID:e.currentFile.id,name:""};"ALL"===e.domain||""===e.domain?e.$prompt("请输入节点类型","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:this.selectlinkname}).then((function(n){t.domain=n.value,e.$api.kgManager.createNode(t).then((function(t){if(200===t.code){s["j"](".graphcontainer").style("cursor","");var n=t.data;n.x=e.txx,n.y=e.tyy,n.fx=e.txx,n.fy=e.tyy,e.graph.nodes.push(n),e.updategraph()}})).catch((function(t){e.$message.error("createSingleNode: "+t)}))})).catch((function(t){e.$message.error(t)})):(t.domain=e.domain,e.$api.kgManager.createNode(t).then((function(t){if(200===t.code){s["j"](".graphcontainer").style("cursor","");var n=t.data;n.x=e.txx,n.y=e.tyy,n.fx=e.txx,n.fy=e.tyy,e.graph.nodes.push(n),e.updategraph()}})).catch((function(t){e.$message.error("createSingleNode: "+t)})))},deletenode:function(e){var t=this;t.$confirm("此操作将删除该节点及周边关系(不可恢复), 是否继续?","三思而后行",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var n={fileID:t.currentFile.id,domain:t.domain,nodeid:t.selectnodeid};t.$api.kgManager.deleteNode(n).then((function(n){if(200===n.code){t.svg.selectAll(e).remove();for(var a=n.data,i=0;i<a.length;i++)for(var r=0;r<t.graph.links.length;r++)t.graph.links[r].uuid===a[i].uuid&&(t.graph.links.splice(r,1),r-=1);var o=-1;for(r=0;r<t.graph.nodes.length;r++)if(t.graph.nodes[r].uuid===t.selectnodeid){o=r;break}o>=0&&(t.selectnodeid=0,t.graph.nodes.splice(r,1),t.updategraph(),t.resetentity(),t.$message({type:"success",message:"操作成功!"}))}})).catch((function(e){t.$message.error("deletenode: "+e)}))})).catch((function(){t.$message({type:"info",message:"已取消删除"})}))},deletelink:function(){var e=this;this.$confirm("此操作将删除该关系(不可恢复), 是否继续?","三思而后行",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var t={fileID:e.currentFile.id,domain:e.domain,shipid:e.selectnodeid};e.$api.kgManager.deleteLink(t).then((function(t){if(200===t.code){for(var n=-1,a=0;a<e.graph.links.length;a++)if(e.graph.links[a].uuid===e.selectnodeid){n=a;break}n>=0&&(e.selectnodeid=0,e.graph.links.splice(a,1),e.updategraph(),e.isdeletelink=!1)}})).catch((function(t){e.$message.error("deletelink: "+t)}))})).catch((function(){this.$message({type:"info",message:"已取消删除"})}))},createlink:function(e,t,n){var a=this;a.$prompt("请输入关系类型","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:this.selectlinkname}).then((function(n){var i={fileID:a.currentFile.id,domain:n.value,sourceid:e,targetid:t,ship:""};a.$api.kgManager.createLink(i).then((function(e){if(200===e.code){var t=e.data;a.graph.links.push(t),a.updategraph(),a.isaddlink=!1}})).catch((function(e){a.$message.error("createlink: "+e)}))}))},updatelinkName:function(){var e=this;e.$prompt("请输入关系名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:this.selectlinkname}).then((function(t){value=t.value;var n={fileID:e.currentFile.id,domain:e.domain,shipid:e.selectnodeid,shipname:value};e.$api.kgManager.updateLink(n).then((function(t){if(200===t.code){var n=t.data;e.graph.links.forEach((function(e){e.uuid===n.uuid&&(e.name=n.name)})),e.selectnodeid=0,e.updategraph(),e.isaddlink=!1,e.selectlinkname=""}})).catch((function(t){e.$message.error("updatelink: "+t)}))})).catch((function(){e.$message({type:"info",message:"取消输入"})}))},updatenodename:function(e){var t=this;t.$prompt("编辑节点名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:e.name}).then((function(n){value=n.value;var a={fileID:t.currentFile.id,domain:e.type,nodeid:e.uuid,nodename:value};t.$api.kgManager.getRelationNodeCount(a).then((function(n){if(200===n.code){if(0!==e.uuid)for(var a=0;a<t.graph.nodes.length;a++)t.graph.nodes[a].uuid===e.uuid&&(t.graph.nodes[a].name=value);t.updategraph(),t.$message({message:"操作成功",type:"success"})}})).catch((function(e){t.$message.error("updatenodename: "+e)}))})).catch((function(){t.$message({type:"info",message:"取消操作"})}))},addmaker:function(){var e=this.svg.append("marker").attr("id","arrow").attr("markerUnits","strokeWidth").attr("markerWidth","20").attr("markerHeight","20").attr("viewBox","0 -5 10 10").attr("refX","22").attr("refY","0").attr("orient","auto"),t="M0,-5L10,0L0,5";e.append("path").attr("d",t).attr("fill","#fce6d4")},drawnode:function(e){var t=this,n=e.enter().append("circle");return n.attr("r",(function(e){return"undefined"!=typeof e.r&&""!==e.r?e.r:40})),n.attr("fill",(function(e){return"undefined"!=typeof e.color&&""!==e.color?e.color:"undefined"!=typeof e.type&&t.nodeColorMap.has(e.type)?t.nodeColorMap.get(e.type):"#ff4500"})),n.style("opacity",.9),n.style("stroke",(function(e){return"undefined"!=typeof e.color&&""!==e.color?e.color:"#EDFDFF"})),n.style("stroke-opacity",.6),n.append("title").text((function(e){return e.name})),n.on("mouseover",(function(e,n){t.nodedetail=e})),n.on("dblclick",(function(e){t.updatenodename(e)})),n.on("mouseenter",(function(e){var t=s["j"](this)._groups[0][0];t.classList.contains("selected")||s["j"](this).style("stroke-width","6")})),n.on("mouseleave",(function(e){var t=s["j"](this)._groups[0][0];t.classList.contains("selected")||s["j"](this).style("stroke-width","2")})),n.on("click",(function(e,n){var a=".out_buttongroup_"+n;if(t.svg.selectAll(".buttongroup").classed("circle_opreate",!0),t.svg.selectAll(a).classed("circle_opreate",!1),t.graphEntity=e,t.selectnodeid=e.uuid,t.selectnodename=e.name,t.isaddlink){if(t.selecttargetnodeid=e.uuid,t.selectsourcenodeid===t.selecttargetnodeid||0===t.selectsourcenodeid||0===t.selecttargetnodeid)return;t.createlink(t.selectsourcenodeid,t.selecttargetnodeid,"RE"),t.selectsourcenodeid=0,t.selecttargetnodeid=0,e.fixed=!1,s["c"].stopPropagation()}if(t.nodeinfo=new Map,e.name&&t.nodeinfo.set("名称",[{id:e.uuid,info:e.name}]),e.type&&t.nodeinfo.set("节点类型",[{id:e.uuid,info:e.type}]),t.graph.links.forEach((function(n){if(n.sourceid==e.uuid)if(t.nodeinfo.has(n.name)){var a=t.nodeinfo.get(n.name);a.push({id:n.targetid,info:n.targetname}),t.nodeinfo.set(n.name,a)}else{a=new Array({id:n.targetid,info:n.targetname});t.nodeinfo.set(n.name,a)}})),t.nodeinfo.has("原因")){var i=t.nodeinfo.get("原因"),r=[];i.forEach((function(e){r.push(e["id"])})),t.graph.links.forEach((function(e){var t=r.indexOf(e.sourceid);-1!=t&&(i[t]["info2"]=e.targetname)})),t.nodeinfo.set("原因",i)}})),n.call(s["b"]().on("start",t.dragstarted).on("drag",t.dragged).on("end",t.dragended)),n},drawnodetext:function(e){var t=e.enter().append("text").style("fill","#000").attr("dy",4).attr("font-family","微软雅黑").attr("text-anchor","middle").text((function(e){if("undefined"==typeof e.name)return"";if(e.name.length>8){var t=e.name.slice(0,7)+"...";return t}return e.name}));return t.style("pointer-events","none"),t},drawnodesymbol:function(e){var t=this,n="M566.92736 550.580907c30.907733-34.655573 25.862827-82.445653 25.862827-104.239787 0-108.086613-87.620267-195.805867-195.577173-195.805867-49.015467 0-93.310293 18.752853-127.68256 48.564907l-0.518827-0.484693-4.980053 4.97664c-1.744213 1.64864-3.91168 2.942293-5.59104 4.72064l0.515413 0.484693-134.69696 133.727573L216.439467 534.8352l0 0 137.478827-136.31488c11.605333-10.410667 26.514773-17.298773 43.165013-17.298773 36.051627 0 65.184427 29.197653 65.184427 65.24928 0 14.032213-5.33504 26.125653-12.73856 36.829867l-131.754667 132.594347 0.515413 0.518827c-10.31168 11.578027-17.07008 26.381653-17.07008 43.066027 0 36.082347 29.16352 65.245867 65.184427 65.245867 16.684373 0 31.460693-6.724267 43.035307-17.07008l0.515413 0.512M1010.336427 343.49056c0-180.25472-145.882453-326.331733-325.911893-326.331733-80.704853 0-153.77408 30.22848-210.418347 79.0528l0.484693 0.64512c-12.352853 11.834027-20.241067 28.388693-20.241067 46.916267 0 36.051627 29.16352 65.245867 65.211733 65.245867 15.909547 0 29.876907-6.36928 41.192107-15.844693l0.38912 0.259413c33.624747-28.030293 76.301653-45.58848 123.511467-45.58848 107.99104 0 195.549867 87.6544 195.549867 195.744427 0 59.815253-27.357867 112.71168-69.51936 148.503893l0 0-319.25248 317.928107 0 0c-35.826347 42.2912-88.654507 69.710507-148.340053 69.710507-107.956907 0-195.549867-87.68512-195.549867-195.805867 0-59.753813 27.385173-112.646827 69.515947-148.43904l-92.18048-92.310187c-65.69984 59.559253-107.700907 144.913067-107.700907 240.749227 0 180.28544 145.885867 326.301013 325.915307 326.301013 95.218347 0 180.02944-41.642667 239.581867-106.827093l0.13312 0.129707 321.061547-319.962453-0.126293-0.13312C968.69376 523.615573 1010.336427 438.71232 1010.336427 343.49056L1010.336427 343.49056 1010.336427 343.49056zM1010.336427 343.49056",a=e.enter().append("path").attr("d",n);return a.call(s["b"]().on("start",t.dragstarted).on("drag",t.dragged).on("end",t.dragended)),a},drawnodebutton:function(e){var t=e.enter().append("g").append("use").attr("r",(function(e){return e.r})).attr("xlink:href",(function(e){return"#out_circle"+e.uuid})).attr("class",(function(e,t){return"buttongroup out_buttongroup_"+t})).classed("circle_opreate",!0);return t},drawlink:function(e){var t=this,n=e.enter().append("path").attr("stroke-width",2).attr("stroke","#fce6d4").attr("fill","#DEB887").attr("id",(function(e){return"invis_"+e.lk.sourceid+"-"+e.lk.name+"-"+e.lk.targetid}));return n.on("dblclick",(function(e){t.selectnodeid=e.lk.uuid,t.isdeletelink?t.deletelink():t.updatelinkName()})),n.on("mouseenter",(function(e){s["j"](this).attr("stroke","#ff9e9e"),t.nodedetail=e.lk,s["j"]("#nodedetail").style("display","block")})),n.on("mouseleave",(function(e){s["j"](this).attr("stroke","#fce6d4")})),n},drawlinktext:function(e){var t=this,n=e.enter().append("text").style("fill","#e3af85").append("textPath").attr("startOffset","50%").attr("text-anchor","middle").attr("xlink:href",(function(e){return"#invis_"+e.lk.sourceid+"-"+e.lk.name+"-"+e.lk.targetid})).style("font-size",14).text((function(e){if(""!==e.lk.name)return e.lk.name}));return n.on("mouseover",(function(e){t.selectnodeid=e.lk.uuid,t.selectlinkname=e.lk.name})),n},dragstarted:function(e){this.simulation.alpha(1).alphaDecay(0).restart(),e.fx=e.x,e.fy=e.y,e.fixed=!0},dragged:function(e){e.fx=s["c"].x,e.fy=s["c"].y},dragended:function(e){this.simulation.alpha(1).alphaDecay(.05).restart()},firstPage:function(){this.pageNum=1},scaleD:function(){this.scale+=5,this.$refs.pdf.$el.style.width=parseInt(this.scale)+"%"},scaleX:function(){100!=this.scale&&(this.scale+=-5,this.$refs.pdf.$el.style.width=parseInt(this.scale)+"%")},prePage:function(){var e=this.pageNum;e=e>1?e-1:this.pageTotalNum,this.pageNum=e},nextPage:function(){var e=this.pageNum;e=e<this.pageTotalNum?e+1:1,this.pageNum=e},getNumPages:function(e){var t=this,n=l["a"].createLoadingTask(e);n.then((function(e){t.pdfUrl=n,t.numPages=e.numPages})).catch((function(e){}))},similar:function(e,t,n){if(!e||!t)return 0;if(e===t)return 100;var a=e.length>t.length?e.length:t.length,i=e.length,r=t.length,o=[];n=n||2;var s,l,c,d,u,f=function(e,t,n){return e<t?e<n?e:n:t<n?t:n};if(0===i)return r;if(0===r)return i;for(s=0;s<=i;s++)o[s]=[],o[s][0]=s;for(l=0;l<=r;l++)o[0][l]=l;for(s=1;s<=i;s++)for(c=e.charAt(s-1),l=1;l<=r;l++)d=t.charAt(l-1),u=c===d?0:1,o[s][l]=f(o[s-1][l]+1,o[s][l-1]+1,o[s-1][l-1]+u);var p=100*(1-o[i][r]/a);return p.toFixed(n)}}},f=u,p=(n("6b43"),n("2877")),h=Object(p["a"])(f,a,i,!1,null,"5afee0f0",null);t["default"]=h.exports},a0fc5:function(e,t,n){"use strict";var a=n("a4ebe"),i=n.n(a);i.a},a4ebe:function(e,t,n){},eed2:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n("9f12"),i=n("53fe"),r=n("8f4d"),o=function(){function e(){Object(a["a"])(this,e)}return Object(i["a"])(e,[{key:"predict",value:function(e){return Object(r["a"])({url:"/sensordata/deviceSensor/predict",method:"get",params:{deviceId:e}})}},{key:"type",value:function(e){return Object(r["a"])({url:"/sensordata/deviceSensor/type",method:"get",params:{deviceId:e}})}}]),e}()}}]);