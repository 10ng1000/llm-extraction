(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b21df9b8","chunk-5e02163a","chunk-546d5106","chunk-d9e12920","chunk-810901bc"],{1952:function(e,t,a){"use strict";var i=a("8f4d");t["a"]={save:function(e){return Object(i["a"])({url:"/form/make/save",method:"post",data:e})},saveFormSource:function(e){return Object(i["a"])({url:"/form/make/saveFormSource",method:"post",data:e})},saveBasicInfo:function(e){return Object(i["a"])({url:"/form/make/saveBasicInfo",method:"post",data:e})},delete:function(e){return Object(i["a"])({url:"/form/make/delete",method:"delete",params:{ids:e}})},queryById:function(e){return Object(i["a"])({url:"/form/make/queryById",method:"get",params:{id:e}})},getTableColumnList:function(e){return Object(i["a"])({url:"/form/make/getTableColumnList",method:"get",params:e})},getTableList:function(e){return Object(i["a"])({url:"/form/make/getTableList",method:"get",params:e})},list:function(e){return Object(i["a"])({url:"/form/make/list",method:"get",params:e})},validateTableNoExist:function(e){return Object(i["a"])({url:"/form/make/validateTableNoExist",method:"get",params:e})},validateKeyNoExist:function(e){return Object(i["a"])({url:"/form/make/validateKeyNoExist",method:"get",params:e})},createMenu:function(e){return Object(i["a"])({url:"/form/make/createMenu",method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=utf-8"},data:e})}}},"307a8":function(e,t,a){},"5b74":function(e,t,a){},"6b47":function(e,t,a){"use strict";var i=a("5b74"),r=a.n(i);r.a},7334:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"创建菜单","close-on-click-modal":!1,width:"1000px",visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{ref:"inputForm",attrs:{size:"small",model:e.inputForm,"label-width":"120px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSubmit()},submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"上级菜单",prop:"parent.id",rules:[{required:!0,message:"请选择上级菜单",trigger:"blur"}]}},[a("SelectTree",{ref:"menuParentTree",attrs:{props:{value:"id",label:"name",children:"children"},data:e.menuList,value:e.inputForm.parent.id,clearable:!0,accordion:!0},on:{getValue:function(t){e.inputForm.parent.id=t}}})],1),a("el-form-item",{attrs:{label:"名称",prop:"name",rules:[{required:!0,message:"名称不能为空",trigger:"blur"}]}},[a("el-input",{attrs:{maxlength:"200",placeholder:"菜单名称"},model:{value:e.inputForm.name,callback:function(t){e.$set(e.inputForm,"name",t)},expression:"inputForm.name"}})],1),"2"!==e.inputForm.type?a("el-form-item",{attrs:{label:"菜单图标",prop:"icon"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{clearable:"",readonly:!0,placeholder:"菜单图标名称"},on:{focus:e.selectIcon},model:{value:e.inputForm.icon,callback:function(t){e.$set(e.inputForm,"icon",t)},expression:"inputForm.icon"}})],1):e._e(),a("data-rule-list",{ref:"dataRuleList",attrs:{form:e.form}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small",icon:"el-icon-circle-close"},on:{click:function(t){e.visible=!1}}},[e._v("关闭")]),a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-circle-check"},on:{click:function(t){return e.doSubmit()}}},[e._v("确定")])],1)],1),a("Icon",{ref:"icon",on:{getValue:function(t){return e.inputForm.icon=t}}})],1)},r=[],n=(a("b0c0"),a("ac62")),o=a("fd68"),l=a("9269"),s=a("755f"),c=a("1952"),u={data:function(){return{visible:!1,menuList:[],form:{},menuListTreeProps:{label:"name",children:"children"},inputForm:{parent:{id:""},name:"",id:"",icon:"",dataRuleDTOList:[],formId:""}}},components:{SelectTree:o["a"],DataRuleList:l["default"],Icon:n["a"]},methods:{init:function(e){var t=this;this.form=e,this.inputForm.name=e.name,this.inputForm.formId=e.id,s["a"].treeData().then((function(e){var a=e.data;t.menuList=a})),this.visible=!0,this.$nextTick((function(){t.$refs["inputForm"].resetFields(),t.$refs.dataRuleList.dataRuleDTOList=[],t.$refs.menuParentTree.clearHandle()}))},iconActiveHandle:function(e){this.inputForm.icon=e},selectIcon:function(){this.$refs.icon.visible=!0},doSubmit:function(){var e=this;this.$refs["inputForm"].validate((function(t){t&&(e.inputForm.dataRuleDTOList=e.$refs.dataRuleList.dataRuleDTOList,c["a"].createMenu(e.inputForm).then((function(t){var a=t.data;e.$message.success({dangerouslyUseHTMLString:!0,message:a}),e.visible=!1})))}))}}},m=u,d=a("2877"),p=Object(d["a"])(m,i,r,!1,null,null,null);t["default"]=p.exports},9269:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{padding:"10px"}},[a("el-row",{staticStyle:{"margin-bottom":"10px"}},[a("el-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{title:"如需对动态表单创建数据权限，请添加数据规则。添加后的规则，可在[菜单管理->数据规则]中查看。",type:"success"}}),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.add()}}},[e._v("添加数据规则")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"table",staticStyle:{width:"100%"},attrs:{data:e.dataRuleDTOList,size:"small"}},[a("el-table-column",{attrs:{type:"selection","header-align":"center",align:"center",width:"50"}}),a("el-table-column",{attrs:{prop:"name","header-align":"center",align:"center",width:"120px",label:"数据规则名称"}}),a("el-table-column",{attrs:{prop:"className","header-align":"center",align:"center",label:"表名"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"field","header-align":"center",align:"center",label:"规则字段"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"express","header-align":"center",align:"center",label:"规则条件"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.$dictUtils.getDictLabel("t_express",t.row.express,""))+" ")]}}])}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"value","header-align":"center",align:"center",label:"规则值"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"sqlSegment","header-align":"center",align:"center",width:"100px",label:"自定义sql"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"remarks","header-align":"center",align:"center",label:"备注信息"}}),a("el-table-column",{key:Math.random(),attrs:{fixed:"right","header-align":"center",align:"center",width:"150",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.edit(t.row)}}},[e._v("修改")]),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.del(t.row)}}},[e._v(" 删除 ")])]}}])})],1),a("data-rule-form",{ref:"dataRuleForm",on:{addRow:function(t){return e.saveDataRuleForm(arguments)}}})],1)},r=[],n=(a("4160"),a("a434"),a("159b"),a("f20b")),o={data:function(){return{dataRuleDTOList:[],loading:!1,rows:[],menuId:"",pageNo:1,pageSize:-1,total:0,title:""}},props:["dataRuleTitle","form"],components:{DataRuleForm:n["default"]},methods:{saveDataRuleForm:function(e){var t=this;""===e[0]?this.dataRuleDTOList.push(e[1]):this.dataRuleDTOList.forEach((function(a,i){a===e[0]&&t.dataRuleDTOList.splice(i,1,e[1])}))},add:function(){this.$refs.dataRuleForm.init("add",{},{menuId:this.menuId,dsName:this.form.dataSource.enName,tableName:this.form.tableName})},edit:function(e){this.$refs.dataRuleForm.init("edit",e,{menuId:this.menuId,dsName:this.form.dataSource.enName,tableName:this.form.tableName})},del:function(e){var t=this;this.$confirm("确定删除该条记录吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.dataRuleDTOList.forEach((function(e,a){t.dataRuleDTOList.splice(a,1)}))}))}}},l=o,s=(a("6b47"),a("2877")),c=Object(s["a"])(l,i,r,!1,null,null,null);t["default"]=c.exports},"9c4f":function(e,t,a){"use strict";var i=a("8f4d");t["a"]={save:function(e){return Object(i["a"])({url:"/database/datalink/dataSource/save",method:"post",data:e})},test:function(e){return Object(i["a"])({url:"/database/datalink/dataSource/test",method:"post",data:e})},checkEnName:function(e,t){return Object(i["a"])({url:"/database/datalink/dataSource/checkEnName",method:"get",params:{oldEnName:e,enName:t}})},delete:function(e){return Object(i["a"])({url:"/database/datalink/dataSource/delete",method:"delete",params:{ids:e}})},queryById:function(e){return Object(i["a"])({url:"/database/datalink/dataSource/queryById",method:"get",params:{id:e}})},list:function(e){return Object(i["a"])({url:"/database/datalink/dataSource/list",method:"get",params:e})},treeData:function(){return Object(i["a"])({url:"/database/datalink/dataSource/treeData",method:"get"})}}},ac62:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"图标选择","close-on-click-modal":!1,visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[a("el-tabs",{attrs:{value:"first",type:"card"}},[a("el-tab-pane",{attrs:{label:"Element图标",name:"first"}},[a("ul",{staticClass:"icon-list"},e._l(e.iconList,(function(t,i){return a("li",{key:i},[a("el-button",{class:{"is-active":t===e.icon},on:{click:function(a){return e.iconActiveHandle(t)}}},[a("i",{class:t})])],1)})),0)]),a("el-tab-pane",{attrs:{label:"Font Awesome图标",name:"second"}},[a("ul",{staticClass:"icon-list"},e._l(e.iconList2,(function(t,i){return a("li",{key:i},[a("el-button",{class:{"is-active":t===e.icon},on:{click:function(a){return e.iconActiveHandle(t)}}},[a("i",{class:t})])],1)})),0)])],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small",icon:"el-icon-circle-close"},on:{click:function(t){e.visible=!1}}},[e._v("关闭")]),a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-circle-check"},on:{click:function(t){return e.doSubmit()}}},[e._v("确定")])],1)],1)},r=[],n=a("7624"),o=a("2e13"),l={name:"Icon",data:function(){return{visible:!1,iconList:n["a"],iconList2:o["a"],icon:""}},methods:{iconActiveHandle:function(e){this.icon=e},doSubmit:function(){this.$emit("getValue",this.icon),this.visible=!1}}},s=l,c=(a("b1ad"),a("2877")),u=Object(c["a"])(s,i,r,!1,null,"e737caa0",null);t["a"]=u.exports},b1ad:function(e,t,a){"use strict";var i=a("307a8"),r=a.n(i);r.a},bad1:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:e.title,fullscreen:"","close-on-click-modal":!1,visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"inputForm",class:"view"===e.method?"readonly":"",attrs:{size:"small",model:e.inputForm,disabled:"view"===e.method,"label-width":"120px"}},[e.visible?a("fm-making-form",{ref:"formDesign",staticStyle:{height:"700px"},attrs:{bindDataTable:"1"!==e.inputForm.autoCreate,data:e.options,uploadPath:this.$http.BASE_URL+"/file/upload?uploadPath=/formbuilder",preview:"",ds:e.inputForm.dataSource,tableName:e.inputForm.tableName,"tab-list":"","generate-json":"",clearable:""}}):e._e()],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small",icon:"el-icon-circle-close"},on:{click:function(t){e.visible=!1}}},[e._v("关闭")]),"view"!=e.method?a("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{size:"small",type:"primary",icon:"el-icon-circle-check"},on:{click:function(t){return e.doSubmit()}}},[e._v("确定")]):e._e()],1)],1)],1)},r=[],n=(a("b0c0"),a("1952")),o={data:function(){return{title:"",method:"",visible:!1,loading:!1,options:{},inputForm:{id:"",code:"",autoCreate:"1",dataSource:{id:"master",name:"本地数据库",enName:"master",type:""},name:"",tableName:"",source:"",version:"",remarks:""}}},components:{},methods:{init:function(e,t){var a=this;this.method=e,this.inputForm.id=t,"add"===e?this.title="新建数据表单":"edit"===e?this.title="修改数据表单":"view"===e&&(this.title="查看数据表单"),this.visible=!0,this.loading=!1,this.$nextTick((function(){a.inputForm.name="",a.inputForm.tableName="",a.inputForm.source="",a.inputForm.version="",a.inputForm.remarks="","edit"!==e&&"view"!==e||(a.loading=!0,n["a"].queryById(a.inputForm.id).then((function(e){var t=e.data;a.inputForm=a.recover(a.inputForm,t),a.inputForm.source&&(a.options=JSON.parse(a.inputForm.source),a.$refs.formDesign.setJSON(a.options)),a.loading=!1})))}))},handleSubmit:function(){},doSubmit:function(){var e=this;this.inputForm.source=JSON.stringify(this.$refs.formDesign.getJSON()),this.$refs["inputForm"].validate((function(t){t&&(e.loading=!0,n["a"].saveFormSource(e.inputForm).then((function(t){var a=t.data;e.visible=!1,e.$message.success(a),e.$emit("refreshDataList")})).catch((function(){e.loading=!1})))}))}}},l=o,s=a("2877"),c=Object(s["a"])(l,i,r,!1,null,null,null);t["default"]=c.exports},bb42:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:e.title,"close-on-click-modal":!1,visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"inputForm",class:"view"===e.method?"readonly":"",attrs:{size:"small",model:e.inputForm,disabled:"view"===e.method,"label-width":"120px"}},[a("el-row",{attrs:{gutter:15}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"表单名称",prop:"name",rules:[{required:!0,message:"表单名称不能为空",trigger:"blur"}]}},[a("el-input",{attrs:{placeholder:"请填写表单名称"},model:{value:e.inputForm.name,callback:function(t){e.$set(e.inputForm,"name",t)},expression:"inputForm.name"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"表单key",prop:"code",rules:[{required:!0,message:"表单key不能为空",trigger:"blur"},{validator:e.validateKeyNoExist,trigger:"blur"}]}},[a("el-input",{attrs:{placeholder:"请填写表单编码"},model:{value:e.inputForm.code,callback:function(t){e.$set(e.inputForm,"code",t)},expression:"inputForm.code"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"所属数据库",prop:"dataSource.id",rules:[{required:!0,message:"所属数据库不能为空",trigger:"blur"}]}},[a("SelectTree",{ref:"dataSourceTree",attrs:{props:{value:"id",label:"label",children:"children"},data:e.dataSourceTree,value:e.inputForm.dataSource.id,label:e.inputForm.dataSource.name,clearable:!0,accordion:!0,disabled:"add"!==e.method},on:{getValue:function(t,a,i){e.inputForm.dataSource.id=t,e.inputForm.dataSource.enName=i.enName,e.inputForm.dataSource.type=i?i.dbType:""}}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"是否自动建表",prop:"autoCreate",rules:[{required:!0,message:"是否自动建表不能为空",trigger:"blur"}]}},[a("el-radio-group",{attrs:{disabled:"add"!==e.method},on:{change:e.changeAutoCreate},model:{value:e.inputForm.autoCreate,callback:function(t){e.$set(e.inputForm,"autoCreate",t)},expression:"inputForm.autoCreate"}},e._l(e.$dictUtils.getDictList("yes_no"),(function(t){return a("el-radio",{key:t.id,attrs:{label:t.value}},[e._v(e._s(t.label))])})),1)],1)],1),a("el-col",{attrs:{span:24}},["0"===e.inputForm.autoCreate?a("el-form-item",{attrs:{label:"表名",prop:"tableName",rules:[{required:!0,message:"表名不能为空",trigger:"blur"}]}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:"add"!==e.method,filterable:"",placeholder:"请选择表"},model:{value:e.inputForm.tableName,callback:function(t){e.$set(e.inputForm,"tableName",t)},expression:"inputForm.tableName"}},e._l(e.dataTable,(function(e){return a("el-option",{key:e.name,attrs:{label:e.nameAndComments,value:e.name}})})),1)],1):a("el-form-item",{attrs:{label:"表名",prop:"tableName",rules:[{validator:e.validateValid,trigger:"blur"},{required:!0,message:"表名不能为空",trigger:"blur"},{validator:e.validateTableNoExist,trigger:"blur"}]}},[a("el-input",{attrs:{disabled:"add"!==e.method,placeholder:"请输入表名"},model:{value:e.inputForm.tableName,callback:function(t){e.$set(e.inputForm,"tableName",t)},expression:"inputForm.tableName"}},[a("el-button",{attrs:{slot:"append",disabled:"add"!==e.method},on:{click:e.createTableName},slot:"append"},[e._v("生成随机表名")])],1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"备注信息",prop:"remarks",rules:[]}},[a("el-input",{attrs:{type:"textarea",placeholder:"请填写备注信息"},model:{value:e.inputForm.remarks,callback:function(t){e.$set(e.inputForm,"remarks",t)},expression:"inputForm.remarks"}})],1)],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small",icon:"el-icon-circle-close"},on:{click:function(t){e.visible=!1}}},[e._v("关闭")]),"view"!=e.method?a("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{size:"small",type:"primary",icon:"el-icon-circle-check"},on:{click:function(t){return e.doSubmit()}}},[e._v("确定")]):e._e()],1)],1)],1)},r=[],n=(a("4de4"),a("0d03"),a("b0c0"),a("fd68")),o=a("1952"),l=a("9c4f"),s={data:function(){return{title:"",method:"",visible:!1,loading:!1,dataSourceTree:[],dataTable:[],oldCode:"",oldTableName:"",inputForm:{id:"",code:"",autoCreate:"1",dataSource:{id:"master",name:"本地数据库",enName:"master",type:""},name:"",tableName:"",remarks:""}}},components:{SelectTree:n["a"]},watch:{"inputForm.dataSource.id":{handler:function(e){var t=this;o["a"].getTableList({"dataSource.enName":this.inputForm.dataSource.enName}).then((function(e){var a=e.data;t.dataTable=a.rows}))},immediate:!0,deep:!1},dataTable:function(e){var t=this;if("0"===this.inputForm.autoCreate){var a=e.filter((function(e){return e.name===t.inputForm.tableName}));0===a.length&&(this.inputForm.tableName="")}}},methods:{init:function(e,t){var a=this;this.method=e,this.inputForm.id=t,"add"===e?this.title="新建表单":"edit"===e?this.title="修改表单":"view"===e&&(this.title="查看表单"),l["a"].treeData().then((function(e){var t=e.data;a.dataSourceTree=t})),this.visible=!0,this.loading=!1,this.$nextTick((function(){a.$refs.inputForm.resetFields(),"edit"!==e&&"view"!==e||(a.loading=!0,o["a"].queryById(a.inputForm.id).then((function(e){var t=e.data;a.inputForm=a.recover(a.inputForm,t),a.oldCode=a.inputForm.code,a.oldTableName=a.inputForm.tableName,a.loading=!1})))}))},changeAutoCreate:function(){this.inputForm.tableName=""},createTableName:function(){this.inputForm.tableName="jp_form_"+(new Date).getTime()},validateKeyNoExist:function(e,t,a){"edit"===this.method&&this.inputForm.code===this.oldCode&&a(),o["a"].validateKeyNoExist({key:t}).then((function(e){var t=e.data;t?a():a(new Error("表单key已经存在"))}))},validateTableNoExist:function(e,t,a){"edit"===this.method&&this.inputForm.tableName===this.oldTableName&&a(),o["a"].validateTableNoExist({name:t,"dataSource.enName":this.inputForm.dataSource.enName}).then((function(e){var t=e.data;t?a():a(new Error("表在数据库中已经存在"))}))},validateValid:function(e,t,a){t&&!/^[A-Za-z]+[A-Za-z0-9_-]*$/.test(t)?a(new Error("请输入合法的表名，只能包含A-Za-z0-9_-这些字符，且必须以英文字符开头!")):a()},doSubmit:function(){var e=this;this.$refs["inputForm"].validate((function(t){t&&(e.loading=!0,o["a"].saveBasicInfo(e.inputForm).then((function(t){var a=t.data;e.visible=!1,e.$message.success(a),e.$emit("refreshDataList"),e.loading=!1})).catch((function(){e.loading=!1})))}))}}},c=s,u=a("2877"),m=Object(u["a"])(c,i,r,!1,null,null,null);t["default"]=m.exports},f20b:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:e.title,"append-to-body":!0,"close-on-click-modal":!1,visible:e.visible},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"inputForm",class:"view"===e.method?"readonly":"",attrs:{size:"small",model:e.inputForm,disabled:"view"===e.method,"label-width":"120px"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSubmit()},submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"数据规则名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"数据规则名称"},model:{value:e.inputForm.name,callback:function(t){e.$set(e.inputForm,"name",t)},expression:"inputForm.name"}})],1),a("el-form-item",{attrs:{label:"表名",prop:"className"}},[a("el-input",{attrs:{placeholder:"表名"},model:{value:e.inputForm.className,callback:function(t){e.$set(e.inputForm,"className",t)},expression:"inputForm.className"}})],1),a("el-form-item",{attrs:{label:"规则字段",prop:"field"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择表"},model:{value:e.inputForm.field,callback:function(t){e.$set(e.inputForm,"field",t)},expression:"inputForm.field"}},e._l(e.dataTableColumns,(function(e){return a("el-option",{key:e.name,attrs:{label:e.nameAndComments,value:e.name}})})),1)],1),a("el-form-item",{attrs:{label:"规则条件",prop:"express"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"规则条件"},model:{value:e.inputForm.express,callback:function(t){e.$set(e.inputForm,"express",t)},expression:"inputForm.express"}},e._l(e.$dictUtils.getDictList("t_express"),(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"规则值",prop:"value"}},[a("el-input",{attrs:{placeholder:"value"},model:{value:e.inputForm.value,callback:function(t){e.$set(e.inputForm,"value",t)},expression:"inputForm.value"}})],1),a("el-form-item",{attrs:{label:"自定义sql",prop:"sqlSegment"}},[a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"备注"},model:{value:e.inputForm.sqlSegment,callback:function(t){e.$set(e.inputForm,"sqlSegment",t)},expression:"inputForm.sqlSegment"}})],1),a("el-form-item",{attrs:{label:"备注",prop:"remarks"}},[a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"备注"},model:{value:e.inputForm.remarks,callback:function(t){e.$set(e.inputForm,"remarks",t)},expression:"inputForm.remarks"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small",icon:"el-icon-circle-close"},on:{click:function(t){e.visible=!1}}},[e._v("关闭")]),"view"!=e.method?a("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],attrs:{size:"small",type:"primary",icon:"el-icon-circle-check"},on:{click:function(t){return e.doSubmit()}}},[e._v("确定")]):e._e()],1)],1)},r=[],n=a("1952"),o={data:function(){return{visible:!1,loading:!1,method:"",title:"",oldInputForm:"",dataTableColumns:[],inputForm:{id:"",menuId:"",name:"",className:"",field:"",express:"",value:"",sqlSegment:"",remarks:""}}},methods:{init:function(e,t,a){var i=this;this.method=e,this.inputForm.id=a.id,this.inputForm.menuId=a.menuId,this.inputForm.className=a.tableName,"add"===e?this.title="新增数据规则":"edit"===e?this.title="修改数据规则":"view"===e&&(this.title="查看数据规则"),this.visible=!0,this.$nextTick((function(){i.$refs["inputForm"].resetFields(),i.getTableColumnList(a.tableName,a.dsName),i.$nextTick((function(){i.$refs.inputForm.resetFields(),i.inputForm.id="",i.oldInputForm="","edit"!==e&&"view"!==e||(i.oldInputForm=t,i.inputForm=JSON.parse(JSON.stringify(t)))}))}))},getTableColumnList:function(e,t){var a=this;n["a"].getTableColumnList({name:e,"dataSource.enName":t||"master"}).then((function(e){var t=e.data;a.dataTableColumns=t.rows}))},doSubmit:function(){var e=this;this.$refs["inputForm"].validate((function(t){t&&(e.$emit("addRow",e.oldInputForm,JSON.parse(JSON.stringify(e.inputForm))),e.visible=!1)}))}}},l=o,s=a("2877"),c=Object(s["a"])(l,i,r,!1,null,null,null);t["default"]=c.exports},febc0:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page"},[a("el-form",{ref:"searchForm",staticClass:"query-form",attrs:{size:"small",inline:!0,model:e.searchForm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.refreshList()},submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{prop:"name"}},[a("el-input",{attrs:{size:"small",placeholder:"表单名称",clearable:""},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search"},on:{click:function(t){return e.refreshList()}}},[e._v("查询")]),a("el-button",{attrs:{size:"small",icon:"el-icon-refresh-right"},on:{click:function(t){return e.resetSearch()}}},[e._v("重置")])],1)],1),a("div",{staticClass:"bg-white top"},[a("vxe-toolbar",{attrs:{refresh:{query:e.refreshList}},scopedSlots:e._u([{key:"buttons",fn:function(){return[e.hasPermission("form:make:add")?a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:function(t){return e.add()}}},[e._v("新建")]):e._e(),e.hasPermission("form:make:add")?a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-edit",disabled:e.$refs.makeFormTable&&1!==e.$refs.makeFormTable.getCheckboxRecords().length,plain:""},on:{click:function(t){return e.design()}}},[e._v("设计")]):e._e(),e.hasPermission("form:make:edit")?a("el-button",{attrs:{type:"warning",size:"small",icon:"el-icon-edit-outline",disabled:e.$refs.makeFormTable&&1!==e.$refs.makeFormTable.getCheckboxRecords().length,plain:""},on:{click:function(t){return e.edit()}}},[e._v("修改")]):e._e(),e.hasPermission("form:make:del")?a("el-button",{attrs:{type:"danger",size:"small",icon:"el-icon-delete",disabled:e.$refs.makeFormTable&&0===e.$refs.makeFormTable.getCheckboxRecords().length,plain:""},on:{click:function(t){return e.del()}}},[e._v("删除")]):e._e()]},proxy:!0}])}),a("div",{staticStyle:{height:"calc(100% - 80px)"}},[a("vxe-table",{ref:"makeFormTable",attrs:{border:"inner","auto-resize":"",resizable:"",height:"auto",loading:e.loading,size:"small","show-header-overflow":"","show-overflow":"","highlight-hover-row":"","menu-config":{},"print-config":{},"import-config":{},"export-config":{},"sort-config":{remote:!0},data:e.dataList,"checkbox-config":{}},on:{"sort-change":e.sortChangeHandle}},[a("vxe-column",{attrs:{type:"seq",width:"40"}}),a("vxe-column",{attrs:{type:"checkbox",width:"40px"}}),a("vxe-column",{attrs:{title:"表单名称",field:"name",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasPermission("echarts:edit")?a("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(a){return e.edit(t.row.id)}}},[e._v(e._s(t.row.name))]):e.hasPermission("echarts:view")?a("el-link",{attrs:{type:"primary",underline:!1},on:{click:function(a){return e.view(t.row.id)}}},[e._v(e._s(t.row.name))]):a("span",[e._v(e._s(t.row.name))])]}}])}),a("vxe-column",{attrs:{title:"表名",field:"tableName",sortable:""}}),a("vxe-column",{attrs:{title:"表单key",field:"code",sortable:""}}),a("vxe-column",{attrs:{title:"所属数据库",field:"dataSource.name",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return["master"===t.row.dataSource.id?a("p",[e._v(" 本地数据库 ")]):a("p",[e._v(" "+e._s(t.row.dataSource.name)+" ")])]}}])}),a("vxe-column",{attrs:{title:"版本号",field:"version",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s("V "+t.row.version+".0")+" ")]}}])}),a("vxe-column",{attrs:{title:"操作",width:"250px",fixed:"right",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasPermission("form:make:edit")?a("el-button",{attrs:{type:"text",icon:"el-icon-edit",size:"mini"},on:{click:function(a){return e.design(t.row.id)}}},[e._v("设计")]):e._e(),a("el-divider",{attrs:{direction:"vertical"}}),e.hasPermission("form:make:del")?a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(a){return e.del(t.row.id)}}},[e._v("删除")]):e._e(),a("el-divider",{attrs:{direction:"vertical"}}),e.hasPermission("form:make:view")?a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-view"},on:{click:function(a){return e.preview(t.row)}}},[e._v(" 预览")]):e._e(),a("el-divider",{attrs:{direction:"vertical"}}),e.hasPermission("form:make:deploy")?a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-s-promotion"},on:{click:function(a){return e.release(t.row)}}},[e._v("发布")]):e._e()]}}])})],1),a("vxe-pager",{attrs:{background:"",size:"small","current-page":e.tablePage.currentPage,"page-size":e.tablePage.pageSize,total:e.tablePage.total,"page-sizes":[10,20,100,1e3,{label:"全量数据",value:1e6}],layouts:["PrevPage","JumpNumber","NextPage","FullJump","Sizes","Total"]},on:{"page-change":e.currentChangeHandle}})],1)],1),a("BasicForm",{ref:"basicForm",on:{refreshDataList:e.refreshList}}),a("MakeForm",{ref:"makeForm",on:{refreshDataList:e.refreshList}}),a("MenuForm",{ref:"menuForm",on:{refreshDataList:e.refreshList}})],1)},r=[],n=(a("a4d3"),a("4de4"),a("4160"),a("a15b"),a("d81d"),a("b0c0"),a("e439"),a("dbb4"),a("b64b"),a("159b"),a("2fa7")),o=a("bb42"),l=a("bad1"),s=a("7334"),c=a("9269"),u=a("1952");function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){Object(n["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var p={data:function(){return{searchForm:{},dataList:[],tablePage:{total:0,currentPage:1,pageSize:10,orders:[]},dataRuleTitle:"",rightVisible:!1,loading:!1}},components:{MakeForm:l["default"],BasicForm:o["default"],MenuForm:s["default"],DataRuleList:c["default"]},activated:function(){this.refreshList()},methods:{refreshList:function(){var e=this;this.loading=!0,u["a"].list(d({current:this.tablePage.currentPage,size:this.tablePage.pageSize,orders:this.tablePage.orders},this.searchForm)).then((function(t){var a=t.data;e.dataList=a.records,e.tablePage.total=a.total,e.loading=!1}))},currentChangeHandle:function(e){var t=e.currentPage,a=e.pageSize;this.tablePage.currentPage=t,this.tablePage.pageSize=a,this.refreshList()},sortChangeHandle:function(e){this.tablePage.orders=[],null!=e.order&&this.tablePage.orders.push({column:this.$utils.toLine(e.property),asc:"asc"===e.order}),this.refreshList()},add:function(){this.$refs.basicForm.init("add","")},design:function(e){e=e||this.$refs.makeFormTable.getCheckboxRecords().map((function(e){return e.id}))[0],this.$refs.makeForm.init("edit",e)},edit:function(e){e=e||this.$refs.makeFormTable.getCheckboxRecords().map((function(e){return e.id}))[0],this.$refs.basicForm.init("edit",e)},view:function(e){this.$refs.makeForm.init("view",e)},release:function(e){e.source?this.$refs.menuForm.init(e):this.$message.warning("请先设计表单!")},preview:function(e){var t=this;e.source?u["a"].queryById(e.id).then((function(a){var i=a.data;i.source?t.options=JSON.parse(i.source):t.options={list:[],config:{labelWidth:100,labelPosition:"right",size:"small",customClass:""}},t.$router.push({path:"/form/generateList",query:{title:e.name,id:e.id,previewMode:!0}})})):this.$message.warning("请先设计表单!")},del:function(e){var t=this,a=e||this.$refs.makeFormTable.getCheckboxRecords().map((function(e){return e.id})).join(",");this.$confirm("确定删除所选项吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,u["a"].delete(a).then((function(e){var a=e.data;t.loading=!1,t.$message.success(a),t.refreshList()}))}))},showRight:function(e){var t=this;this.rightVisible=!0,this.$nextTick((function(){t.$refs.dataRuleList.form=e,t.$refs.dataRuleList.refreshList(e.id),t.dataRuleTitle=e.name}))},closeRight:function(){this.rightVisible=!1},resetSearch:function(){this.$refs.searchForm.resetFields(),this.refreshList()}}},f=p,b=a("2877"),h=Object(b["a"])(f,i,r,!1,null,null,null);t["default"]=h.exports}}]);