(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4335aea0"],{7896:function(e,t,a){},"7b0b9":function(e,t,a){"use strict";var l=a("7896"),n=a.n(l);n.a},"87bb":function(e,t,a){"use strict";a("99af");var l=a("8f4d");t["a"]={executeSql:function(e,t){return Object(l["a"])({url:"/database/table/executeSql/".concat(e,"?dataSourceId=").concat(t),method:"get"})},save:function(e){return Object(l["a"])({url:"/gen/genTable/saveTableFromDB",method:"post",data:e})},queryAlter:function(e,t){return Object(l["a"])({url:"/database/table/alter",method:"get",params:{dataSourceId:e,name:t}})},submitAlter:function(e){return Object(l["a"])({url:"/database/table/alter/do",method:"post",data:e})},queryCreate:function(e){return Object(l["a"])({url:"/database/table/create",method:"get",params:{dataSourceId:e}})},submitCreate:function(e){return Object(l["a"])({url:"/database/table/create/do",method:"post",data:e})},list:function(e){return Object(l["a"])({url:"/database/table/list",method:"get",params:e})},drop:function(e,t){return Object(l["a"])({url:"/database/table/drop",method:"delete",params:{tableName:e,dataSourceId:t}})}}},"94db":function(e,t,a){},"99cf":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"el-scrollbar__wrap wrap-white padding-20"},[a("div",{staticClass:"el-scrollbar__view"},[a("el-page-header",{staticClass:"page-header",attrs:{content:"编辑表"},on:{back:e.goBack}}),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"inputForm",attrs:{size:"small",model:e.inputForm,"label-width":"150px"}},[a("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"表名",prop:"name",rules:[{required:!0,message:"模型名称不能为空",trigger:"blur"}]}},[a("el-input",{attrs:{size:"small",disabled:"edit"===e.method,placeholder:""},model:{value:e.inputForm.name,callback:function(t){e.$set(e.inputForm,"name",t)},expression:"inputForm.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"模式",prop:"schema"}},[a("el-input",{attrs:{size:"small",disabled:!0,placeholder:""},model:{value:e.inputForm.schema,callback:function(t){e.$set(e.inputForm,"schema",t)},expression:"inputForm.schema"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据库",prop:"catalog"}},[a("el-input",{attrs:{size:"small",disabled:!0,placeholder:""},model:{value:e.inputForm.catalog,callback:function(t){e.$set(e.inputForm,"catalog",t)},expression:"inputForm.catalog"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"描述",prop:"description"}},[a("el-input",{attrs:{size:"small",placeholder:"请填写描述"},model:{value:e.inputForm.description,callback:function(t){e.$set(e.inputForm,"description",t)},expression:"inputForm.description"}})],1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("label",{staticStyle:{"font-wight":"fold"}},[e._v("数据源列配置")])]),a("el-button-group",{staticClass:"pull-right"},[a("el-button",{attrs:{type:"default",size:"small",icon:"el-icon-plus"},on:{click:e.addRow}},[e._v("增加一列")]),a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-circle-check"},on:{click:e.doSubmit}},[e._v("保存")])],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{size:"small",data:e.inputForm.columns}},[a("el-table-column",{attrs:{prop:"name",label:"列名"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"small"},model:{value:t.row.name,callback:function(a){e.$set(t.row,"name",a)},expression:"scope.row.name"}})]}}])}),a("el-table-column",{attrs:{prop:"type",label:"类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"请选择"},model:{value:t.row.type,callback:function(a){e.$set(t.row,"type",a)},expression:"scope.row.type"}},e._l(e.columnTypes,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.name}})})),1)]}}])}),a("el-table-column",{attrs:{prop:"size",label:"长度"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"small"},model:{value:t.row.size,callback:function(a){e.$set(t.row,"size",a)},expression:"scope.row.size"}})]}}])}),a("el-table-column",{attrs:{prop:"defaultValue",label:"默认值"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"small"},model:{value:t.row.defaultValue,callback:function(a){e.$set(t.row,"defaultValue",a)},expression:"scope.row.defaultValue"}})]}}])}),a("el-table-column",{attrs:{label:"主键"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{model:{value:t.row.primaryKey,callback:function(a){e.$set(t.row,"primaryKey",a)},expression:"scope.row.primaryKey"}},[e._v("主键")])]}}])}),a("el-table-column",{attrs:{label:"非空"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{model:{value:t.row.required,callback:function(a){e.$set(t.row,"required",a)},expression:"scope.row.required"}},[e._v("非空")])]}}])}),a("el-table-column",{attrs:{label:"自增"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-checkbox",{model:{value:t.row.autoIncrement,callback:function(a){e.$set(t.row,"autoIncrement",a)},expression:"scope.row.autoIncrement"}},[e._v("自增")])]}}])}),a("el-table-column",{attrs:{prop:"description",label:"说明"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"small"},model:{value:t.row.description,callback:function(a){e.$set(t.row,"description",a)},expression:"scope.row.description"}})]}}])}),a("el-table-column",{attrs:{title:"操作",width:"200px",fixed:"right",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),e.deleteRow(t.$index,e.inputForm.columns)}}},[e._v(" 移除 ")])]}}])})],1)],1)],1)],1)],1)])])},n=[],r=(a("a434"),a("b0c0"),a("fd68")),i=a("87bb"),o={data:function(){return{title:"",method:"",loading:!1,columnTypes:[],inputForm:{dataSourceId:"",name:"",schema:"",catalog:"",description:"",columns:[]}}},activated:function(){var e=this;this.$refs.inputForm.resetFields(),this.inputForm.columns=[],this.inputForm.dataSourceId=this.$route.query.dataSourceId,this.inputForm.name=this.$route.query.name,this.method=this.$route.query.method,"edit"===this.method?i["a"].queryAlter(this.inputForm.dataSourceId,this.inputForm.name).then((function(t){var a=t.data;e.inputForm=e.recoverNotNull(e.inputForm,a.table),e.columnTypes=a.columnTypes})):i["a"].queryCreate(this.inputForm.dataSourceId).then((function(t){var a=t.data;e.inputForm=e.recoverNotNull(e.inputForm,a.table),e.columnTypes=a.columnTypes}))},components:{SelectTree:r["a"]},methods:{deleteRow:function(e,t){t.splice(e,1)},addRow:function(){this.inputForm.columns.push({name:"",type:"",size:64,defaultValue:"",primaryKey:!1,required:!1,autoIncrement:!1,description:""})},doSubmit:function(){var e=this;this.$refs["inputForm"].validate((function(t){t&&(e.loading=!0,"add"===e.method?i["a"].submitCreate(e.inputForm).then((function(t){var a=t.data;e.$message.success(a),e.goBack(),e.loading=!1})).catch((function(){e.loading=!1})):i["a"].submitAlter(e.inputForm).then((function(t){var a=t.data;e.$message.success(a),e.goBack(),e.loading=!1})).catch((function(){e.loading=!1})))}))},goBack:function(){this.$store.dispatch("tagsView/delView",{fullPath:this.$route.fullPath}),this.$router.push({path:"/database/datatable/Table"})}}},s=o,u=(a("7b0b9"),a("2877")),c=Object(u["a"])(s,l,n,!1,null,"21d37ed8",null);t["default"]=c.exports},e110:function(e,t,a){"use strict";var l=a("94db"),n=a.n(l);n.a},fd68:function(e,t,a){"use strict";var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-select",{attrs:{value:e.valueTitle,size:e.size,disabled:e.disabled,clearable:e.clearable,placeholder:e.placeholderText},on:{clear:e.clearHandle}},[a("el-option",{staticClass:"options",attrs:{value:e.valueTitle,label:e.valueTitle}},[a("el-tree",{ref:"selectTree",attrs:{id:"tree-option",accordion:e.accordion,data:e.optionData,"show-checkbox":e.showCheckbox,props:e.props,"highlight-current":"","node-key":e.props.value,"default-expanded-keys":e.defaultExpandedKey},on:{"check-change":e.handleCheckChange,"node-click":e.handleNodeClick}})],1)],1)},n=[],r=(a("4de4"),a("4160"),a("a15b"),a("d81d"),a("ac1f"),a("1276"),a("159b"),{name:"el-tree-select",props:{props:{type:Object,default:function(){return{value:"id",label:"label",children:"children"}}},data:{type:Array,default:function(){return[]}},list:{type:Array,default:function(){return null}},value:{type:String,default:function(){return""}},url:{type:String,default:function(){return null}},disabled:{type:Boolean,dafault:function(){return!1}},showCheckbox:{type:Boolean,dafault:function(){return!1}},label:{type:String,default:function(){return null}},clearable:{type:Boolean,default:function(){return!0}},accordion:{type:Boolean,default:function(){return!1}},size:{type:String,default:function(){return"small"}},placeholder:{type:String,default:function(){return"请选择"}},isOnlySelectLeaf:{type:Boolean,default:function(){return!1}}},data:function(){return{valueId:this.value,valueTitle:this.label,defaultExpandedKey:[],placeholderText:this.placeholder,treeList:[],valueData:this.data}},created:function(){var e=this;if(null!==this.url){this.placeholderText="加载数据中...";var t=setInterval((function(){e.placeholderText=e.placeholderText+"."}),500);this.$http({url:this.url,method:"get"}).then((function(a){var l=a.data;e.valueData=l,e.setTreeList(e.valueData),e.$nextTick((function(){e.initHandle(),e.placeholderText=e.placeholder,clearInterval(t)}))}))}else this.valueData=this.data,this.setTreeList(this.valueData)},methods:{setTreeList:function(e){for(var t in e)this.treeList.push(e[t]),e[t].children&&this.setTreeList(e[t].children)},initHandle:function(){var e=this;if(this.valueId)if(this.showCheckbox){var t=this.valueId.split(",");this.$refs.selectTree.setCheckedKeys(t);var a=[];t.forEach((function(t){e.treeList.forEach((function(l){t===l[e.props.value]&&a.push(l[e.props.label])}))})),this.valueTitle=a.join(",")}else this.$refs.selectTree.getNode(this.valueId)&&(this.valueTitle=this.$refs.selectTree.getNode(this.valueId).data[this.props.label],this.$refs.selectTree.setCurrentKey(this.valueId),this.defaultExpandedKey=[this.valueId]);this.initScroll()},getNode:function(e){return this.$refs.selectTree.getNode(e)},initScroll:function(){this.$nextTick((function(){var e=document.querySelectorAll(".el-scrollbar .el-select-dropdown__wrap")[0],t=document.querySelectorAll(".el-scrollbar .el-scrollbar__bar");e&&(e.style.cssText="margin: 0px; max-height: none; overflow: hidden;"),t&&t.forEach((function(e){return e.style.width=0}))}))},handleNodeClick:function(e){this.showCheckbox||(e["disabled"]?this.$message.warning("节点（"+e[this.props.label]+"）被禁止选择，请重新选择。"):this.isOnlySelectLeaf&&e.children.length>0?this.$message.warning("不能选择根节点（"+e[this.props.label]+"）请重新选择。"):(this.valueTitle=e[this.props.label],this.valueId=null==e[this.props.value]?"":e[this.props.value],this.$emit("getValue",this.valueId,this.valueTitle,e)))},handleCheckChange:function(e,t,a){var l=this,n=this.$refs.selectTree.getCheckedNodes();this.valueTitle=n.map((function(e){return e[l.props.label]})).join(","),this.valueId=n.map((function(e){return e[l.props.value]})).join(","),this.valueId=null===this.valueId?"":this.valueId,this.$emit("getValue",this.valueId,this.valueTitle)},clearHandle:function(){this.valueTitle="",this.valueId="",this.defaultExpandedKey=[],this.clearSelected(),this.$emit("getValue","",null,null)},clearSelected:function(){var e=document.querySelectorAll("#tree-option .el-tree-node");e.forEach((function(e){return e.classList.remove("is-current")}))}},watch:{value:function(){this.valueId=this.value,""===this.value||null===this.value||void 0===this.value?this.clearHandle():this.initHandle()},data:function(){this.valueData=this.data}},computed:{optionData:function(){if(this.list){var e=JSON.parse(JSON.stringify(this.list));return e.filter((function(t){var a=e.filter((function(e){return t.id===e.parentId}));return a.length>0&&(t.children=a),"0"===t.parentId}))}return this.valueData}}}),i=r,o=(a("e110"),a("2877")),s=Object(o["a"])(i,l,n,!1,null,"9bc5da12",null);t["a"]=s.exports}}]);