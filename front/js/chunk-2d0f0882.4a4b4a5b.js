(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0f0882"],{"9d89":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("h4",{staticStyle:{"text-align":"center"}},[t._v(t._s(t.title))]),s("el-tabs",{attrs:{type:"border-card"},model:{value:t.taskSelectedTab,callback:function(e){t.taskSelectedTab=e},expression:"taskSelectedTab"}},[s("el-tab-pane",{attrs:{label:"表单信息",name:"form-first"}},["2"===t.formType?s(t.form,{ref:"form",tag:"component",class:t.formReadOnly?"readonly":"",attrs:{id:"printForm",formReadOnly:t.formReadOnly,businessId:t.businessId}}):t._e(),"2"!==t.formType?s("PreviewForm",{ref:"form",attrs:{id:"printForm",processDefinitionId:t.procDefId,edit:!0,taskFormData:t.taskFormData}}):t._e()],1),t.procInsId?s("el-tab-pane",{attrs:{label:"流程信息",name:"form-second"}},[s("flow-time-line",{attrs:{historicTaskList:t.historicTaskList}})],1):t._e(),s("el-tab-pane",{attrs:{label:"流程图",name:"form-third"}},[s("el-card",{staticClass:"box-card",attrs:{shadow:"hover"}},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("span",[t._v("流程图")])]),t.procInsId?s("flow-chart",{ref:"chart1",attrs:{processInstanceId:t.procInsId}}):t._e(),t.procInsId?t._e():s("flow-chart",{ref:"chart2",attrs:{processDefId:t.procDefId}})],1)],1),t.procInsId?s("el-tab-pane",{attrs:{label:"流转记录",name:"form-forth"}},[s("flow-step",{attrs:{historicTaskList:t.historicTaskList}})],1):t._e()],1),s("el-card",{staticStyle:{"margin-top":"10px","padding-bottom":"66px"}},[s("el-form",{ref:"auditForm",attrs:{size:"small",model:t.auditForm,"label-width":"120px"}},[s("el-col",{attrs:{span:16}},[t.procInsId?t._e():s("el-form-item",{attrs:{label:"流程标题",prop:"title"}},[s("el-input",{attrs:{placeholder:"请输入流程标题"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),t.taskId?s("el-form-item",{attrs:{label:"审批信息",prop:"message"}},[s("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入审批意见"},model:{value:t.auditForm.message,callback:function(e){t.$set(t.auditForm,"message",e)},expression:"auditForm.message"}})],1):t._e()],1),s("el-col",{attrs:{span:16}},[s("el-form-item",[s("el-checkbox",{model:{value:t.isCC,callback:function(e){t.isCC=e},expression:"isCC"}},[t._v("是否抄送")])],1)],1),s("el-col",{attrs:{span:16}},[t.isCC?s("el-form-item",{attrs:{rules:[{required:!0,message:"用户不能为空",trigger:"blur"}],prop:"userIds",label:"抄送给"}},[s("user-select",{attrs:{value:t.auditForm.userIds},on:{getValue:function(e){t.auditForm.userIds=e}}},[t._v(">")])],1):t._e()],1),s("el-col",{attrs:{span:16}},[s("el-form-item",[s("el-checkbox",{model:{value:t.isAssign,callback:function(e){t.isAssign=e},expression:"isAssign"}},[t._v("指定下一步处理者(不设置就使用默认处理人)")])],1)],1),s("el-col",{attrs:{span:16}},[t.isAssign?s("el-form-item",{attrs:{rules:[{required:!0,message:"用户不能为空",trigger:"blur"}],prop:"assignee",label:"指定"}},[s("user-select",{attrs:{limit:1,value:t.auditForm.assignee},on:{getValue:function(e){t.auditForm.assignee=e}}},[t._v(">")])],1):t._e()],1)],1)],1),s("div",{staticClass:"FlowFormFooter"},[t._l(t.buttons,(function(e,a){return[s("div",{directives:[{name:"show",rawName:"v-show",value:"0"===e.isHide,expression:"button.isHide === '0'"}],key:a},["_flow_print"!==e.code?s("el-button",{directives:[{name:"noMoreClick",rawName:"v-noMoreClick"}],key:a,attrs:{type:"primary",plain:""},on:{click:function(s){return t.submit(e,t.buttons)}}},[t._v(t._s(e.name))]):t._e(),"_flow_print"===e.code?s("el-button",{directives:[{name:"print",rawName:"v-print",value:t.printObj,expression:"printObj"},{name:"noMoreClick",rawName:"v-noMoreClick"}],key:a,attrs:{type:"primary",plain:""}},[t._v(t._s(e.name))]):t._e()],1)]}))],2),s("task-back-nodes",{ref:"taskBackNodes",on:{getBackTaskDefKey:t.back}}),s("user-select-dialog",{ref:"transferUserSelectDialog",attrs:{title:"选择转办用户",limit:1},on:{doSubmit:t.selectUsersToTransferTask}}),s("user-select-dialog",{ref:"delegateUserSelectDialog",attrs:{title:"选择委派用户",limit:1},on:{doSubmit:t.selectUsersToDelateTask}}),s("user-select-dialog",{ref:"addSignTaskUserSelectDialog",attrs:{title:"选择加签用户"},on:{doSubmit:t.selectUsersToAddSignTask}})],1)},r=[],i=(s("a4d3"),s("4de4"),s("4160"),s("a15b"),s("d81d"),s("b0c0"),s("e439"),s("dbb4"),s("b64b"),s("2ca0"),s("159b"),s("2fa7")),o=s("326b"),n=s("150f"),c=s("6c19"),l=s("cbe8"),u=s("7525"),d=s("6714"),f=s("c7d4"),h=s("ab5f"),m=s("dd2c"),p=s("9674"),k=s("f9a9");function b(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function I(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?b(Object(s),!0).forEach((function(e){Object(i["a"])(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):b(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var g=s("101e"),y={activated:function(){var t=this;this.init(),"2"===this.formType?"/404"===this.formUrl?(this.form=null,this.$message.info("没有关联流程表单!")):this.form=g("modules".concat(this.formUrl)):this.$nextTick((function(){"/404"===t.formUrl?t.$refs.form.createForm(""):t.$refs.form.createForm(t.formUrl),m["a"].getHistoryTaskFormData({processInstanceId:t.procInsId,procDefId:t.procDefId,taskDefKey:t.taskDefKey}).then((function(e){var s=e.data;t.taskFormData=s}))})),"start"===this.status?this.buttons=[{code:"_flow_start",name:"启动",isHide:"0"}]:this.procDefKey&&this.taskDefKey&&h["a"].queryByDefIdAndTaskId({processDefId:this.procDefKey,taskDefId:this.taskDefKey}).then((function(e){var s=e.data;t.buttons=s.flowButtonList})),this.procInsId&&this.taskService.historicTaskList(this.procInsId).then((function(e){var s=e.data;t.historicTaskList=s}))},components:{UserSelect:o["a"],UserSelectDialog:d["a"],PreviewForm:n["default"],TaskBackNodes:c["default"],FlowStep:l["default"],FlowTimeLine:u["default"]},watch:{isAssign:function(t){t||(this.assignee=null)},taskSelectedTab:function(t){"form-third"===t&&(this.procInsId?this.$refs.chart1.init():this.$refs.chart2.init())}},methods:{init:function(){this.taskSelectedTab="form-first",this.procDefId=this.$route.query.procDefId,this.procDefKey=this.$route.query.procDefKey,this.formType=this.$route.query.formType,this.formUrl=this.$route.query.formUrl,this.taskId=this.$route.query.taskId,this.taskDefKey=this.$route.query.taskDefKey,this.status=this.$route.query.status,this.title=this.$route.query.formTitle,this.printObj.popTitle=this.title,this.businessId=this.$route.query.businessId,this.procInsId=this.$route.query.procInsId,this.formReadOnly=void 0!==this.$route.query.formReadOnly&&"false"!==this.$route.query.formReadOnly&&!1!==this.$route.query.formReadOnly,this.isCC=!1,this.isAssign=!1,this.auditForm.assignee=null,this.auditForm.userIds=null,this.auditForm.message=""},cc:function(t){var e=this;this.isCC&&this.auditForm.userIds&&this.$refs["auditForm"].validate((function(s){s&&p["a"].save({userIds:e.auditForm.userIds,procDefId:e.procDefId,procInsId:t,procDefName:"",procInsName:e.title,taskName:""})}))},save:function(){},start:function(t){var e=this;"2"===this.formType?this.$refs.form.saveForm((function(s,a,r){t=I({},t,{},r),f["a"].start(I({procDefKey:e.procDefKey,businessTable:s,businessId:a},t,{title:e.title,assignee:e.auditForm.assignee})).then((function(t){var s=t.data;e.$message.success("启动成功"),e.$store.dispatch("tagsView/delView",{fullPath:e.$route.fullPath}),e.$router.push("/flowable/task/TodoList"),e.cc(s)}))})):this.$refs.form.submitStartFormData(I({processDefinitionId:this.procDefId},t,{title:this.title,assignee:this.auditForm.assignee}),(function(t){e.$store.dispatch("tagsView/delView",{fullPath:e.$route.fullPath}),e.$router.push("/flowable/task/TodoList"),e.cc(t)}))},agree:function(t){this.commit(t)},reject:function(){var t=this;this.$confirm("确定驳回流程吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){f["a"].backNodes(t.taskId).then((function(e){var s=e.data,a=s;if(a.length>0){var r=a[a.length-1].taskDefKey;t.back(r)}}))}))},turnBack:function(){this.$refs.taskBackNodes.init(this.taskId)},back:function(t){var e=this;f["a"].back(I({taskId:this.taskId,backTaskDefKey:t},this.auditForm)).then((function(t){var s=t.data;e.$message.success("回退成功"),e.$store.dispatch("tagsView/delView",{fullPath:e.$route.fullPath}),e.$router.push("/flowable/task/TodoList"),e.cc(s)}))},addMultiInstance:function(){},selectUsersToAddSignTask:function(t){var e=this,s=t.map((function(t){return t.id})).join(",");f["a"].addSignTask({taskId:this.taskId,userIds:JSON.stringify(s),comment:"",flag:!1}).then((function(t){var s=t.data;e.$message.success(s)}))},delMultiInstance:function(){},transfer:function(){this.$refs.transferUserSelectDialog.init()},selectUsersToTransferTask:function(t){var e=this;f["a"].transfer(this.taskId,t[0].id).then((function(t){var s=t.data;e.$message.success(s),e.$router.push("/flowable/task/TodoList")}))},delegate:function(){this.$refs.delegateUserSelectDialog.init()},selectUsersToDelateTask:function(t){var e=this;f["a"].delegate(this.taskId,t[0].id).then((function(t){var s=t.data;e.$message.success(s),e.$router.push("/flowable/task/TodoList")}))},stop:function(){var t=this;this.$confirm("确定终止流程吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){k["a"].stop(t.procInsId,t.auditForm.message).then((function(e){var s=e.data;t.$message.success(s),t.$router.push("/flowable/task/TodoList")}))}))},print:function(){},commit:function(t){var e=this;"2"===this.formType?this.$refs.form.saveForm((function(s,a,r){t=I({},t,{},r),f["a"].audit({taskId:e.taskId,taskDefKey:e.taskDefKey,procInsId:e.procInsId,procDefId:e.procDefId,vars:t,comment:e.auditForm,assignee:e.auditForm.assignee}).then((function(t){var s=t.data;e.$message.success("提交成功"),e.$store.dispatch("tagsView/delView",{fullPath:e.$route.fullPath}),e.$router.push("/flowable/task/TodoList"),e.cc(s)}))})):this.$refs.form.submitTaskFormData(t,this.procInsId,this.taskId,this.auditForm.assignee,this.auditForm,(function(t){e.$store.dispatch("tagsView/delView",{fullPath:e.$route.fullPath}),e.$router.push("/flowable/task/TodoList"),e.cc(t)}))},submit:function(t,e){var s={};switch(e.forEach((function(t){t.code&&!t.code.startsWith("_flow_")&&(s[t.code]=!1)})),t.code&&!t.code.startsWith("_flow_")&&(s[t.code]=!0),s.title=this.title,s.assignee=this.auditForm.assignee,this.auditForm.type=t.code,this.auditForm.status=t.name,t.code){case"_flow_start":this.start(s);break;case"_flow_save":this.save();break;case"_flow_agree":this.agree();break;case"_flow_reject":this.reject();break;case"_flow_back":this.turnBack();break;case"_flow_add_multi_instance":this.addMultiInstance();break;case"_flow_del_multi_instance":this.delMultiInstance();break;case"_flow_transfer":this.transfer();break;case"_flow_delegate":this.delegate();break;case"_flow_stop":this.stop();break;case"_flow_print":this.print();break;default:this.commit(s)}}},data:function(){return{form:null,formType:"",formUrl:"",taskSelectedTab:"frist",historicTaskList:[],procDefId:"",procInsId:"",formReadOnly:!1,procDefKey:"",taskId:"",taskFormData:[],taskDefKey:"",status:"",title:"",businessId:"",buttons:[],isCC:!1,isAssign:!1,printObj:{id:"printForm",popTitle:"",extraCss:"",extraHead:'<meta http-equiv="Content-Language" content="zh-cn"/>'},auditForm:{message:"",type:"",status:"",userIds:null,assignee:null}}}},v=y,w=s("2877"),_=Object(w["a"])(v,a,r,!1,null,null,null);e["default"]=_.exports}}]);